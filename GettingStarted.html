<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="API reference" href="Reference.html"><link rel="prev" title="Introduction" href="Introduction.html">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>Getting started - NonlinearTMM 1.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">NonlinearTMM 1.4.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">NonlinearTMM 1.4.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Reference.html">API reference</a><input aria-label="Toggle navigation of API reference" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Material.html">Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="TMM.html">TMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="SecondOrderNLTMM.html">Second-order NLTMM</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/GettingStarted.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>Installation of the NonlinearTMM package is possible through pip or from source
code.</p>
<p>Requirements:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.python.org/">Python &gt;= 3.10</a></p></li>
</ul>
<p>Dependencies:</p>
<ul class="simple">
<li><p>C++ code depends on <a class="reference external" href="https://eigen.tuxfamily.org/">Eigen library</a> (already included in package)</p></li>
</ul>
<p>Installation through pip is done like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>NonlinearTMM
</pre></div>
</div>
<p>Alternatively, it is possible to install the package from the source code by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>in the source code folder.</p>
</section>
<section id="package-structure">
<h2>Package structure<a class="headerlink" href="#package-structure" title="Link to this heading">¶</a></h2>
<p>The package has three main classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="Material.html#NonlinearTMM.Material" title="NonlinearTMM.Material"><code class="xref py py-class docutils literal notranslate"><span class="pre">Material</span></code></a></p></li>
<li><p><a class="reference internal" href="TMM.html#NonlinearTMM.TMM" title="NonlinearTMM.TMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">TMM</span></code></a></p></li>
<li><p><a class="reference internal" href="SecondOrderNLTMM.html#NonlinearTMM.SecondOrderNLTMM" title="NonlinearTMM.SecondOrderNLTMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecondOrderNLTMM</span></code></a></p></li>
</ul>
<p>Class <a class="reference internal" href="Material.html#NonlinearTMM.Material" title="NonlinearTMM.Material"><code class="xref py py-class docutils literal notranslate"><span class="pre">Material</span></code></a> is responsible for representing the properties of optical
material, mainly wavelength-dependent refractive indices and second-order
susceptibility tensor for nonlinear processes.</p>
<p>Class <a class="reference internal" href="TMM.html#NonlinearTMM.TMM" title="NonlinearTMM.TMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">TMM</span></code></a> (alias of <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM" title="NonlinearTMM.NonlinearTMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">NonlinearTMM</span></code></a>) has all the standard TMM features:</p>
<ul class="simple">
<li><p>Both p- and s-polarization</p></li>
<li><p>Arbitrary angle of incidence</p></li>
<li><p>Calculation of reflection, transmission and absorption of plane waves (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetIntensities" title="NonlinearTMM.NonlinearTMM.GetIntensities"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetIntensities</span></code></a> and <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetAbsorbedIntensity" title="NonlinearTMM.NonlinearTMM.GetAbsorbedIntensity"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetAbsorbedIntensity</span></code></a>)</p></li>
<li><p>Calculation of electric and magnetic fields inside structure (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetFields" title="NonlinearTMM.NonlinearTMM.GetFields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetFields</span></code></a> and <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetFields2D" title="NonlinearTMM.NonlinearTMM.GetFields2D"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetFields2D</span></code></a>)</p></li>
<li><p>Calculation of field enhancement (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetEnhancement" title="NonlinearTMM.NonlinearTMM.GetEnhancement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetEnhancement</span></code></a>)</p></li>
<li><p>Sweep over any parameter (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.Sweep" title="NonlinearTMM.NonlinearTMM.Sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Sweep</span></code></a>)</p></li>
</ul>
<p>In addition to those standard features, the class has similar functionality to
work with waves with arbitrary profile (e.g. Gaussian beam). The configuration
of the beam is done through attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">wave</span></code> (see class <a class="reference internal" href="TMM.html#NonlinearTMM._Wave" title="NonlinearTMM._Wave"><code class="xref py py-class docutils literal notranslate"><span class="pre">_Wave</span></code></a>).
The interface for the calculations with arbitrary beams is similar to standard TMM:</p>
<ul class="simple">
<li><p>Calculation of reflection, transmission and absorption of beams (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.WaveGetPowerFlows" title="NonlinearTMM.NonlinearTMM.WaveGetPowerFlows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WaveGetPowerFlows</span></code></a>)</p></li>
<li><p>Calculation of electric and magnetic fields inside structure (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.WaveGetFields2D" title="NonlinearTMM.NonlinearTMM.WaveGetFields2D"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WaveGetFields2D</span></code></a>)</p></li>
<li><p>Calculation of field enhancement (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.WaveGetEnhancement" title="NonlinearTMM.NonlinearTMM.WaveGetEnhancement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WaveGetEnhancement</span></code></a>)</p></li>
<li><p>Sweep over any parameter (<a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.WaveSweep" title="NonlinearTMM.NonlinearTMM.WaveSweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WaveSweep</span></code></a>)</p></li>
</ul>
<p>Finally, <a class="reference internal" href="SecondOrderNLTMM.html#NonlinearTMM.SecondOrderNLTMM" title="NonlinearTMM.SecondOrderNLTMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecondOrderNLTMM</span></code></a> class is capable of calculating second-order
nonlinear processes like second-harmonic generation, sum-frequency generation and
difference frequency generation. This has a similar interface to <a class="reference internal" href="TMM.html#NonlinearTMM.TMM" title="NonlinearTMM.TMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">TMM</span></code></a> - it
supports both plane waves and beams.</p>
</section>
<section id="standard-tmm">
<h2>Standard TMM<a class="headerlink" href="#standard-tmm" title="Link to this heading">¶</a></h2>
<section id="plane-waves-example">
<h3>Plane waves example<a class="headerlink" href="#plane-waves-example" title="Link to this heading">¶</a></h3>
<p>As an example, a three-layer structure consisting of a prism (z &lt; 0), a 50-nm-thick silver
film and air is studied. Such a structure supports surface plasmon
resonance (SPR) if excited by p-polarized light and is known as the Kretschmann
configuration. The example code is shown below and could be divided into
the following steps:</p>
<ol class="arabic simple">
<li><p>Specifying material refractive indices.</p></li>
<li><p>Initializing <a class="reference internal" href="TMM.html#NonlinearTMM.TMM" title="NonlinearTMM.TMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">TMM</span></code></a>, setting params and adding layers.</p></li>
<li><p>By using <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.Sweep" title="NonlinearTMM.NonlinearTMM.Sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Sweep</span></code></a> calculate the dependence of reflection, transmission and enhancement factor on the angle of incidence.</p></li>
<li><p>Find the plasmonic resonance from the maximum enhancement.</p></li>
<li><p>Calculate 1D fields at plasmonic resonance by <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetFields" title="NonlinearTMM.NonlinearTMM.GetFields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetFields</span></code></a>.</p></li>
<li><p>Calculate 2D fields at plasmonic resonance by <a class="reference internal" href="TMM.html#NonlinearTMM.NonlinearTMM.GetFields2D" title="NonlinearTMM.NonlinearTMM.GetFields2D"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetFields2D</span></code></a>.</p></li>
<li><p>Plot all results</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">NonlinearTMM</span><span class="w"> </span><span class="kn">import</span> <span class="n">TMM</span><span class="p">,</span> <span class="n">Material</span>


<span class="k">def</span><span class="w"> </span><span class="nf">CalcSpp</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Parameters</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="mf">532e-9</span>  <span class="c1"># Wavelength</span>
    <span class="n">pol</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span>  <span class="c1"># Polarization</span>
    <span class="n">I0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Intensity of incident wave</span>
    <span class="n">metalD</span> <span class="o">=</span> <span class="mf">50e-9</span>  <span class="c1"># Metal film thickness</span>
    <span class="n">enhLayer</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Measure enhancment in the last layer</span>
    <span class="n">ths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>  <span class="c1"># Angle of incidences</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2e-6</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># Field calculation coordinates</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2e-6</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>  <span class="c1"># Field calculation coordinates</span>

    <span class="c1"># Specify materials</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">prism</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ag</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">0.054007</span> <span class="o">+</span> <span class="mf">3.4290</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># Johnson &amp; Christie @ 532nm</span>
    <span class="n">dielectric</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Init TMM</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">tmm</span> <span class="o">=</span> <span class="n">TMM</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">prism</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">metalD</span><span class="p">,</span> <span class="n">ag</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">dielectric</span><span class="p">)</span>

    <span class="c1"># Solve</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="c1"># Calculate reflection, transmission and field enhancement</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ths</span><span class="p">)</span> <span class="o">*</span> <span class="n">prism</span><span class="o">.</span><span class="n">GetN</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">sweepRes</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">Sweep</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">outEnh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layerNr</span><span class="o">=</span><span class="n">enhLayer</span><span class="p">)</span>

    <span class="c1"># Calculate fields at the reflection dip (excitation of SPPs)</span>
    <span class="n">betaMaxEnh</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sweepRes</span><span class="o">.</span><span class="n">enh</span><span class="p">)]</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">betaMaxEnh</span><span class="p">)</span>

    <span class="c1"># Calculate 1D fields</span>
    <span class="n">fields1D</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">GetFields</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>

    <span class="c1"># Calculate 2D fields</span>
    <span class="n">fields2D</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">GetFields2D</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>

    <span class="c1"># Ploting</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">thMaxEnh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">betaMaxEnh</span> <span class="o">/</span> <span class="n">prism</span><span class="o">.</span><span class="n">GetN</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

    <span class="c1"># Reflection / transmission</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">Ir</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">It</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">thMaxEnh</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\theta$ ($\degree$)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Intensity (a.u)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Field enhancement</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">enh</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">thMaxEnh</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\theta$ ($\degree$)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Field enhancement&quot;</span><span class="p">)</span>

    <span class="c1"># Fields 1D</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">zs</span><span class="p">,</span> <span class="n">fields1D</span><span class="o">.</span><span class="n">E</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$E_x$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">zs</span><span class="p">,</span> <span class="n">fields1D</span><span class="o">.</span><span class="n">E</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$E_z$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">zs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fields1D</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;‖E‖&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;z (μm)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(V/m)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Fields 2D</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">fields2D</span><span class="o">.</span><span class="n">Ez</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">zs</span><span class="p">,</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">xs</span><span class="p">,</span> <span class="n">fields2D</span><span class="o">.</span><span class="n">Ez</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;z (μm)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;x (μm)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$E_z$ (V/m)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;docs/images/TMM-example.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">CalcSpp</span><span class="p">()</span>
</pre></div>
</div>
<p>The results of the calculations are shown below. Indeed, there is a sharp dip
in the reflection (R) near the angle of incidence of approximately 44 degrees. At the same angle,
the field enhancement factor is at its maximum and is more than 12 times the incident field. In the lower
panels, the results of the field calculations at plasmonic resonance are presented.
Indeed, a surface wave on the silver-air interface is excited and the characteristic
pattern of fields for SPP is visible.</p>
<img alt="_images/TMM-example.png" src="_images/TMM-example.png" />
</section>
<section id="gaussian-wave-example">
<h3>Gaussian wave example<a class="headerlink" href="#gaussian-wave-example" title="Link to this heading">¶</a></h3>
<p>The previous example was entirely about standard TMM. Now, the calculations are
extended to beams, in this case a Gaussian beam. The steps of the calculations
remain the same, except <a class="reference internal" href="TMM.html#NonlinearTMM._Wave" title="NonlinearTMM._Wave"><code class="xref py py-class docutils literal notranslate"><span class="pre">_Wave</span></code></a> parameters must be set (<a class="reference internal" href="TMM.html#NonlinearTMM.TMM" title="NonlinearTMM.TMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">TMM</span></code></a> has
attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">TMM.wave</span></code>). The Gaussian beam power is set to 10 mW and the waist size
to 10 μm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">NonlinearTMM</span><span class="w"> </span><span class="kn">import</span> <span class="n">TMM</span><span class="p">,</span> <span class="n">Material</span>


<span class="k">def</span><span class="w"> </span><span class="nf">CalcSppGaussianBeam</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Parameters</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="mf">532e-9</span>  <span class="c1"># Wavelength</span>
    <span class="n">pol</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span>  <span class="c1"># Polarization</span>
    <span class="n">I0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Intensity of incident wave</span>
    <span class="n">metalD</span> <span class="o">=</span> <span class="mf">50e-9</span>  <span class="c1"># Metal film thickness</span>
    <span class="n">enhLayer</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Measure enhancment in the last layer</span>
    <span class="n">ths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>  <span class="c1"># Angle of incidences</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">50e-6</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># Field calculation coordinates</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">25e-6</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>  <span class="c1"># Field calculation coordinates</span>
    <span class="n">waveType</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>  <span class="c1"># Wave type</span>
    <span class="n">pwr</span> <span class="o">=</span> <span class="mf">10e-3</span>  <span class="c1"># Beam power [W]</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="mf">10e-6</span>  <span class="c1"># Beam waist size</span>

    <span class="c1"># Specify materials</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">prism</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ag</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">0.054007</span> <span class="o">+</span> <span class="mf">3.4290</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># Johnson &amp; Christie @ 532nm</span>
    <span class="n">dielectric</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Init TMM</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">tmm</span> <span class="o">=</span> <span class="n">TMM</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">prism</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">metalD</span><span class="p">,</span> <span class="n">ag</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">dielectric</span><span class="p">)</span>

    <span class="c1"># Init wave params</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">wave</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">waveType</span><span class="o">=</span><span class="n">waveType</span><span class="p">,</span> <span class="n">w0</span><span class="o">=</span><span class="n">w0</span><span class="p">,</span> <span class="n">pwr</span><span class="o">=</span><span class="n">pwr</span><span class="p">,</span> <span class="n">dynamicMaxX</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxX</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Solve</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="c1"># Calculate reflection, transmission and field enhancement</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ths</span><span class="p">)</span> <span class="o">*</span> <span class="n">prism</span><span class="o">.</span><span class="n">GetN</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">sweepRes</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">WaveSweep</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">outEnh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layerNr</span><span class="o">=</span><span class="n">enhLayer</span><span class="p">)</span>

    <span class="c1"># Calculate fields at the reflection dip (excitation of SPPs)</span>
    <span class="n">betaMaxEnh</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sweepRes</span><span class="o">.</span><span class="n">enh</span><span class="p">)]</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">betaMaxEnh</span><span class="p">)</span>
    <span class="n">fields2D</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">WaveGetFields2D</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>

    <span class="c1"># Ploting</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">thMaxEnh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">betaMaxEnh</span> <span class="o">/</span> <span class="n">prism</span><span class="o">.</span><span class="n">GetN</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

    <span class="c1"># Reflection / transmission</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$P_i$&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">Pr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$P_r$&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">Pt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$P_t$&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">thMaxEnh</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\theta$ ($\degree$)&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Power (mW)&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Field enhancement</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ths</span><span class="p">),</span> <span class="n">sweepRes</span><span class="o">.</span><span class="n">enh</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">thMaxEnh</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\theta$ ($\degree$)&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Field enhancement&quot;</span><span class="p">)</span>

    <span class="c1"># Fields 2D</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">zs</span><span class="p">,</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">xs</span><span class="p">,</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="n">fields2D</span><span class="o">.</span><span class="n">EN</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">5e1</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;z (μm)&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;x (μm)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$‖E‖$ (kV/m)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;docs/images/TMMForWaves-example.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">CalcSppGaussianBeam</span><span class="p">()</span>
</pre></div>
</div>
<p>The results of those calculations are below. Despite the fact that the structure
is the same, the dip in the reflection is different. The reason for this behaviour
is that as the resonances of SPPs are narrow, they also require a well-collimated
beam to excite them. Also, the field enhancement is approximately 3 times lower, as expected. On
the right side, the electric field norm is shown. It is clearly visible that
a Gaussian beam is incident from the left, and it gets reflected from the metal film (z = 0).
Part of the energy is transmitted to excite SPPs at the metal-air interface. The
excited SPPs are propagating on the metal film and are absorbed after approximately 20 μm of
propagation.</p>
<img alt="_images/TMMForWaves-example.png" src="_images/TMMForWaves-example.png" />
</section>
</section>
<section id="second-order-nonlinear-tmm">
<h2>Second-order nonlinear TMM<a class="headerlink" href="#second-order-nonlinear-tmm" title="Link to this heading">¶</a></h2>
<section id="id1">
<h3>Plane waves example<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>As an example, second-harmonic generation (SHG) in a nonlinear crystal is
calculated. The example code is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">NonlinearTMM</span><span class="w"> </span><span class="kn">import</span> <span class="n">Material</span><span class="p">,</span> <span class="n">SecondOrderNLTMM</span>


<span class="k">def</span><span class="w"> </span><span class="nf">CalcSHG</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Parameters</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="mf">1000e-9</span>  <span class="c1"># Pump wavelength</span>
    <span class="n">pol</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>  <span class="c1"># Polarization</span>
    <span class="n">I0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Intensity of incident pump wave</span>
    <span class="n">crystalD</span> <span class="o">=</span> <span class="mf">1000e-6</span>  <span class="c1"># Crystal thickness</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Sweep range for beta</span>

    <span class="c1"># Define materials</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">wlsCrystal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">400e-9</span><span class="p">,</span> <span class="mf">1100e-9</span><span class="p">])</span>
    <span class="n">nsCrystal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.54</span><span class="p">,</span> <span class="mf">1.53</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">prism</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">crystal</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">wlsCrystal</span><span class="p">,</span> <span class="n">nsCrystal</span><span class="p">)</span>
    <span class="n">crystal</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">d22</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
    <span class="n">dielectric</span> <span class="o">=</span> <span class="n">Material</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Init SecondOrderNLTMM</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">tmm</span> <span class="o">=</span> <span class="n">SecondOrderNLTMM</span><span class="p">()</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">P1</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">P2</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">Gen</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span>

    <span class="c1"># Add layers</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">prism</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">crystalD</span><span class="p">,</span> <span class="n">crystal</span><span class="p">)</span>
    <span class="n">tmm</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">dielectric</span><span class="p">)</span>

    <span class="c1"># Beta sweep</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">tmm</span><span class="o">.</span><span class="n">Sweep</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">outP1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outGen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Crystal thickness sweep at normal incidence (beta = 0)</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">thicknesses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">10e-6</span><span class="p">,</span> <span class="mf">2000e-6</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">shg_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thicknesses</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thicknesses</span><span class="p">):</span>
        <span class="n">tmm2</span> <span class="o">=</span> <span class="n">SecondOrderNLTMM</span><span class="p">()</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">P1</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">P2</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">Gen</span><span class="o">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">pol</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">prism</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">crystal</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">AddLayer</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">dielectric</span><span class="p">)</span>
        <span class="n">tmm2</span><span class="o">.</span><span class="n">Solve</span><span class="p">()</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="n">tmm2</span><span class="o">.</span><span class="n">GetIntensities</span><span class="p">()</span>
        <span class="n">shg_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensities</span><span class="o">.</span><span class="n">Gen</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Plot results</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.6</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">))</span>

    <span class="c1"># Left: Schematic of the setup</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Setup&quot;</span><span class="p">)</span>

    <span class="c1"># Draw layers</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rectangle</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;#ddeeff&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;#ffe0cc&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;#ddeeff&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\chi^{(2)}$ crystal&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Pump arrow</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\omega$ pump&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>

    <span class="c1"># SHG arrows (reflected + transmitted)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$2\omega$ R&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">4.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$2\omega$ T&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">)</span>

    <span class="c1"># Middle: SHG R, T vs beta</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">betas</span><span class="p">,</span> <span class="n">sr</span><span class="o">.</span><span class="n">Gen</span><span class="o">.</span><span class="n">Ir</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">betas</span><span class="p">,</span> <span class="n">sr</span><span class="o">.</span><span class="n">Gen</span><span class="o">.</span><span class="n">It</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Intensity ($W/m^</span><span class="si">{2}</span><span class="s2">$)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;SHG intensity vs $\beta$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Right: SHG T vs crystal thickness</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thicknesses</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">shg_t</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Crystal thickness ($\mu m$)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;SHG transmitted ($W/m^</span><span class="si">{2}</span><span class="s2">$)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Thickness dependence ($\beta$ = 0)&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;docs/images/SecondOrderNLTMM-example.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">CalcSHG</span><span class="p">()</span>
</pre></div>
</div>
<p>The results show the reflected and transmitted SHG intensity as a function
of the propagation parameter β. Two s-polarized pump beams at 1000 nm
generate a second-harmonic signal at 500 nm in a 1 mm nonlinear crystal.</p>
<img alt="_images/SecondOrderNLTMM-example.png" src="_images/SecondOrderNLTMM-example.png" />
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Reference.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Introduction.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Introduction</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2017-2026, Ardi Loot
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Getting started</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#package-structure">Package structure</a></li>
<li><a class="reference internal" href="#standard-tmm">Standard TMM</a><ul>
<li><a class="reference internal" href="#plane-waves-example">Plane waves example</a></li>
<li><a class="reference internal" href="#gaussian-wave-example">Gaussian wave example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#second-order-nonlinear-tmm">Second-order nonlinear TMM</a><ul>
<li><a class="reference internal" href="#id1">Plane waves example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=06f1c677"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>